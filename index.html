<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fist Bump Karim</title>
    <style>
        /* Reset default browser styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Main body styling with background image */
        body {
            font-family: 'Arial', sans-serif;
            background: url("cloudBackground.jpg");
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        /* Main container holding both game area and shop */
        .game-container {
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1200px;
            width: 100%;
        }

        /* Left section containing stats and clickable Karim */
        .main-game {
            flex: 2;
            background: rgba(50, 76, 116, 0.6);
            border-radius: 20px;
            padding: 40px;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
        }

        .stats { text-align: center; width: 100%; }

        .coin-count {
            font-size: 48px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 10px;
        }

        .coins-per-click { font-size: 20px; opacity: 0.9; }
        .coins-per-second { font-size: 18px; opacity: 0.8; margin-top: 5px; }

        #karim {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 100px;
            cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            user-select: none;
        }

        #karim:hover  { transform: scale(1.05); }
        #karim > img  { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
        #karim:active { transform: scale(0.95); }

        .click-effect {
            position: absolute;
            font-size: 30px;
            font-weight: bold;
            color: #ffd700;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        @keyframes floatUp {
            0%   { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-100px); }
        }

        #snakeBtn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 12px 16px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            background: #2ecc71;
            color: black;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        #snakeBtn:hover { transform: scale(1.05); }

        #snakeOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        #snakeContainer {
            position: relative;
            background: black;
            padding: 20px;
            border-radius: 16px;
        }

        #snakeGame { border: 2px solid white; }

        #closeSnake {
            position: absolute;
            top: -12px; right: -12px;
            width: 32px; height: 32px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            background: red;
            color: white;
            font-weight: bold;
        }

        .snake-hint { text-align: center; margin-top: 10px; font-size: 14px; opacity: 0.8; }

        .shop {
            flex: 1;
            background: rgba(93, 136, 185, 0.6);
            border-radius: 20px;
            padding: 20px;
            backdrop-filter: blur(10px);
            max-height: 600px;
            overflow-y: auto;
        }

        .shop h2 { text-align: center; margin-bottom: 20px; font-size: 28px; }

        .shop-item {
            background: rgba(255,255,255,0.6);
            border-radius: 10px;
            padding: 24px;
            min-height: 110px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid;
        }

        .shop-item:hover          { background: rgba(255,255,255,0.25); border-color: #ffd700; }
        .shop-item.disabled       { opacity: 1; cursor: not-allowed; }
        .shop-item.disabled:hover { background: rgba(255,255,255,0.15); border-color: transparent; }

        .item-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .item-name   { font-size: 18px; font-weight: bold; color: black; }
        .item-count  { background: rgba(29,25,2,0.3); padding: 3px 10px; border-radius: 12px; font-size: 14px; }
        .item-description { font-size: 14px; opacity: 0.9; margin-bottom: 8px; color: rgb(77,6,6); }
        .item-footer { display: flex; justify-content: space-between; align-items: center; }
        .item-cost   { font-size: 16px; color: #756714; font-weight: bold; }
        .item-effect { font-size: 13px; opacity: 1; }

        .buddy {
            position: absolute;
            width: 10px; height: 10px;
            border-radius: 25%;
            pointer-events: none;
            animation: orbit 6s linear infinite;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            object-fit: cover;
        }

        @keyframes orbit {
            from { transform: rotate(0deg)   translateX(180px) rotate(0deg)    scale(0.25); }
            to   { transform: rotate(360deg) translateX(180px) rotate(-360deg) scale(0.25); }
        }

        .random-picture {
            position: fixed;
            width: 45px; height: 45px;
            cursor: pointer;
            z-index: 999;
            animation: popIn 0.15s ease-out;
        }

        .random-picture img  { width: 100%; height: 100%; object-fit: contain; pointer-events: none; }
        .random-picture:hover { transform: scale(1.2); }

        @keyframes popIn {
            from { transform: scale(0); }
            to   { transform: scale(1); }
        }

        .meter-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.75);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .meter-container {
            background: rgba(30,30,50,0.95);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .meter-title {
            font-size: 28px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255,215,0,0.5);
            margin-bottom: 10px;
        }

        .meter-bar {
            width: 80px; height: 400px;
            background: linear-gradient(to top, #ff4444 0%, #ff8844 40%, #44ff44 85%, #44ff44 100%);
            border-radius: 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(255,215,0,0.3), inset 0 0 20px rgba(0,0,0,0.3);
            border: 3px solid rgba(255,215,0,0.5);
        }

        .green-zone {
            position: absolute;
            width: 100%; height: 15%;
            top: 0;
            background: rgba(68,255,68,0.3);
            border: 2px dashed rgba(255,255,255,0.5);
            box-shadow: 0 0 15px rgba(68,255,68,0.6);
        }

        .meter-marker {
            position: absolute;
            width: 100%; height: 20px;
            background: white;
            bottom: 0;
            box-shadow: 0 0 20px rgba(255,255,255,0.8);
            border-radius: 10px;
            transition: none;
        }

        .meter-button {
            padding: 15px 40px;
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: transform 0.1s, box-shadow 0.1s;
        }

        .meter-button:hover   { transform: translateY(-2px); box-shadow: 0 7px 20px rgba(0,0,0,0.4); }
        .meter-button:active  { transform: translateY(0); }
        .meter-instruction    { font-size: 16px; color: rgba(255,255,255,0.8); text-align: center; }

        .multiplier-display {
            position: fixed;
            top: 20px; left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff6b6b, #ffd700);
            padding: 15px 30px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            box-shadow: 0 5px 20px rgba(0,0,0,0.4);
            z-index: 1000;
            animation: pulse 1s ease-in-out infinite;
        }

        .multiplier-display.good { background: linear-gradient(135deg, #44ff44, #22dd22); }

        @keyframes pulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50%       { transform: translateX(-50%) scale(1.05); }
        }

        .result-flash {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 60px;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 30px currentColor;
            pointer-events: none;
            z-index: 10000;
            animation: flashResult 0.8s ease-out forwards;
        }

        @keyframes flashResult {
            0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50%  { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
        }

        ::-webkit-scrollbar        { width: 8px; }
        ::-webkit-scrollbar-track  { background: rgba(255,255,255,0.1); border-radius: 10px; }
        ::-webkit-scrollbar-thumb  { background: rgba(255,215,0,0.5);   border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255,215,0,0.7); }

        /* ===== MUSIC PLAYER ===== */
        #musicPlayer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(20, 20, 50, 0.92);
            border-radius: 16px;
            padding: 14px 18px;
            backdrop-filter: blur(10px);
            box-shadow: 0 6px 24px rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            min-width: 210px;
            border: 1px solid rgba(255,215,0,0.25);
        }

        /* "Now Playing" label */
        #nowPlaying {
            font-size: 13px;
            color: #ffd700;
            font-weight: bold;
            letter-spacing: 0.4px;
            text-align: center;
        }

        /* Row of numbered track buttons */
        .track-buttons { display: flex; gap: 8px; }

        .track-btn {
            padding: 6px 14px;
            border-radius: 8px;
            border: 2px solid rgba(255,215,0,0.35);
            background: rgba(255,255,255,0.08);
            color: white;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .track-btn:hover  { background: rgba(255,215,0,0.2); border-color: #ffd700; }

        /* Highlight the currently selected track */
        .track-btn.active {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            border-color: #ffd700;
        }

        /* Play/pause + volume row */
        .player-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            justify-content: center;
        }

        #playPauseBtn {
            width: 36px; height: 36px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            font-size: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 8px rgba(0,0,0,0.3);
            transition: transform 0.1s;
            flex-shrink: 0;
        }

        #playPauseBtn:hover { transform: scale(1.1); }

        #volumeSlider {
            -webkit-appearance: none;
            appearance: none;
            width: 90px; height: 4px;
            border-radius: 2px;
            background: rgba(255,255,255,0.2);
            outline: none;
            cursor: pointer;
        }

        #volumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px; height: 14px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
        }

        #volumeSlider::-moz-range-thumb {
            width: 14px; height: 14px;
            border-radius: 50%;
            background: #ffd700;
            cursor: pointer;
            border: none;
        }

        .vol-icon { font-size: 14px; opacity: 0.8; }
    </style>
</head>

<body>

    <!-- Snake game button -->
    <button id="snakeBtn">üêç Play Snake</button>

    <!-- Snake game overlay -->
    <div id="snakeOverlay">
        <div id="snakeContainer">
            <button id="closeSnake">‚úñ</button>
            <canvas id="snakeGame" width="400" height="400"></canvas>
            <div class="snake-hint">Use arrow keys</div>
        </div>
    </div>

    <!-- ===== MUSIC PLAYER =====
         Put song1.mp3, song2.mp3, song3.mp3, and 4THSONG.mp3 in the same
         folder as this file. Press a numbered button to load & play that track.
         Press the same button again (or ‚è∏) to pause. Volume slider on the right. -->
    <div id="musicPlayer">
        <div id="nowPlaying">üéµ No track playing</div>
        <div class="track-buttons">
            <button class="track-btn" id="trackBtn1" onclick="switchTrack(0)">1</button>
            <button class="track-btn" id="trackBtn2" onclick="switchTrack(1)">2</button>
            <button class="track-btn" id="trackBtn3" onclick="switchTrack(2)">3</button>
            <button class="track-btn" id="trackBtn4" onclick="switchTrack(3)">4</button>
        </div>
        <div class="player-controls">
            <button id="playPauseBtn" onclick="togglePlayPause()">‚ñ∂</button>
            <span class="vol-icon">üîä</span>
            <input type="range" id="volumeSlider" min="0" max="1" step="0.01" value="0.5"
                   oninput="setVolume(this.value)">
        </div>
    </div>

    <!-- Hidden audio element (loop keeps it going) -->
    <audio id="bgMusic" loop></audio>

    <!-- Main game -->
    <div class="game-container">
        <div class="main-game">
            <div class="stats">
                <div class="coin-count">üí∞ <span id="coins">0</span></div>
                <div class="coins-per-click">+<span id="coinsPerClick">1</span> per fist bump</div>
                <div class="coins-per-second"><span id="coinsPerSecond">0</span> coins/second</div>
            </div>
            <div id="karim">
                <img src="karimfistbumper.png" alt="Karim fist bump">
            </div>
        </div>

        <div class="shop">
            <h2>üõí Upgrades</h2>
            <div id="shopItems"></div>
        </div>
    </div>

    <script>
        // ===== GAME STATE =====
        let coins            = 0;
        let coinsPerClick    = 1;
        let coinsPerSecond   = 0;
        let globalMultiplier = 1;
        let multiplierTimeoutId = null;
        let meterActive      = false;

        // ===== SHOP ITEMS =====
        const shopItems = [
            {
                id: 'autoClicker1',
                name: 'Nayan Patel',
                description: 'He loves giving karim fist bumps',
                baseCost: 10, effect: 0.1, effectType: 'cps', count: 0,
                imageSrc: './resources/Nayan-Transparent.png'
            },
            {
                id: 'airpods',
                name: 'Air Pods',
                description: 'J Cole makes Karim stronger',
                baseCost: 25, effect: 1, effectType: 'cpc', count: 0,
                imageSrc: './resources/airpods-transparent.png'
            },
            {
                id: 'beanie',
                name: 'Beanie',
                description: 'Snuggly beanie for a snuggly boy',
                baseCost: 100, effect: 1, effectType: 'cps', count: 0,
                imageSrc: './resources/beanie.png'
            },
            {
                id: 'clickMultiplier2',
                name: 'MacBook',
                description: 'Karim loves his shiny new laptop and decides to lock in',
                baseCost: 250, effect: 5, effectType: 'cpc', count: 0,
                imageSrc: './resources/MacBook.png'
            }
        ];

        // ===== DOM REFS =====
        const karimElement         = document.getElementById('karim');
        const coinsDisplay         = document.getElementById('coins');
        const coinsPerClickDisplay = document.getElementById('coinsPerClick');
        const coinsPerSecondDisplay= document.getElementById('coinsPerSecond');
        const shopItemsContainer   = document.getElementById('shopItems');

        // ===== KARIM CLICK =====
        karimElement.addEventListener('click', (e) => {
            coins += coinsPerClick * globalMultiplier;
            updateDisplay();
            renderShop();

            const effect = document.createElement('div');
            effect.className = 'click-effect';
            effect.textContent = `+${Math.floor(coinsPerClick * globalMultiplier)}`;
            effect.style.left = (e.clientX - karimElement.getBoundingClientRect().left) + 'px';
            effect.style.top  = (e.clientY - karimElement.getBoundingClientRect().top)  + 'px';
            karimElement.appendChild(effect);
            setTimeout(() => effect.remove(), 1000);
        });

        // ===== SHOP =====
        function getItemCost(item) {
            return Math.floor(item.baseCost * Math.pow(1.15, item.count));
        }

        function buyItem(item) {
            const cost = getItemCost(item);
            if (coins >= cost) {
                coins -= cost;
                item.count++;
                if (item.effectType === 'cpc') coinsPerClick   += item.effect;
                else if (item.effectType === 'cps') coinsPerSecond += item.effect;

                if (item.id === 'autoClicker1' && item.count <= 200) addBuddy(item.imageSrc, item.count);
                if (item.id === 'airpods' || item.id === 'beanie') updateKarimImage();

                updateDisplay();
                renderShop();
            }
        }

        // ===== SNAKE =====
        const snakeBtn    = document.getElementById('snakeBtn');
        const snakeOverlay= document.getElementById('snakeOverlay');
        const closeSnake  = document.getElementById('closeSnake');
        let snakeRunning  = false;

        snakeBtn.addEventListener('click',   () => { snakeOverlay.style.display = 'flex'; snakeRunning = true; });
        closeSnake.addEventListener('click', () => { snakeOverlay.style.display = 'none'; snakeRunning = false; });

        // ===== BUDDY ORBIT =====
        function addBuddy(imageSrc, count) {
            const buddy = document.createElement('img');
            buddy.src = imageSrc;
            buddy.className = 'buddy';
            buddy.style.animationDelay = `-${(count - 1) * 0.5}s`;
            karimElement.appendChild(buddy);
        }

        // ===== TIMING METER =====
        function startTimingMeter() {
            if (meterActive) return;
            meterActive = true;

            const overlay = document.createElement('div');
            overlay.className = 'meter-overlay';
            overlay.id = 'meterOverlay';
            overlay.innerHTML = `
                <div class="meter-container">
                    <div class="meter-title">HIT THE GREEN!</div>
                    <div class="meter-bar">
                        <div class="green-zone"></div>
                        <div class="meter-marker" id="meterMarker"></div>
                    </div>
                    <button class="meter-button" id="stopButton">STOP!</button>
                    <div class="meter-instruction">Press SPACEBAR or click STOP</div>
                </div>`;
            document.body.appendChild(overlay);

            const marker     = document.getElementById('meterMarker');
            const stopButton = document.getElementById('stopButton');
            const duration   = 1200;
            let startTime    = Date.now();
            let animId, stopped = false;

            function animateMarker() {
                if (stopped) return;
                const progress = Math.min((Date.now() - startTime) / duration, 1);
                marker.style.bottom = (progress * 100) + '%';
                if (progress < 1) { animId = requestAnimationFrame(animateMarker); }
                else { applyMultiplier(false); overlay.remove(); meterActive = false; }
            }

            function stopMeter() {
                if (stopped) return;
                stopped = true;
                cancelAnimationFrame(animId);
                const pos = parseFloat(marker.style.bottom) || 0;
                setTimeout(() => { overlay.remove(); meterActive = false; }, 100);
                applyMultiplier(pos >= 85);
            }

            stopButton.addEventListener('click', stopMeter);
            const spaceHandler = (e) => {
                if (e.code === 'Space') { e.preventDefault(); stopMeter(); document.removeEventListener('keydown', spaceHandler); }
            };
            document.addEventListener('keydown', spaceHandler);
            animateMarker();
        }

        function applyMultiplier(isSuccess) {
            if (multiplierTimeoutId) {
                clearTimeout(multiplierTimeoutId);
                const old = document.getElementById('multiplierDisplay');
                if (old) old.remove();
            }

            globalMultiplier = isSuccess ? 2 : 0.5;

            const flash = document.createElement('div');
            flash.className = 'result-flash';
            flash.textContent = isSuccess ? 'PERFECT! 2x COINS' : 'MISS! 0.5x COINS';
            flash.style.color = isSuccess ? '#44ff44' : '#ff4444';
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 800);

            const display = document.createElement('div');
            display.id = 'multiplierDisplay';
            display.className = `multiplier-display ${isSuccess ? 'good' : ''}`;
            document.body.appendChild(display);

            let timeLeft = 15;
            function updateDisplay() {
                if (!display.parentElement) return;
                display.textContent = `${globalMultiplier > 1 ? 'üî•' : '‚ùÑÔ∏è'} ${globalMultiplier}x Coins ‚Äî ${timeLeft}s left`;
                timeLeft--;
                if (timeLeft < 0) { globalMultiplier = 1; display.remove(); multiplierTimeoutId = null; }
                else { multiplierTimeoutId = setTimeout(updateDisplay, 1000); }
            }
            updateDisplay();
        }

        // ===== RANDOM FIST =====
        function spawnRandomPicture() {
            const pic = document.createElement('img');
            pic.className = 'random-picture';
            pic.src = './resources/Punch-Green.png';
            pic.style.left = `${Math.random() * window.innerWidth * 0.25}px`;
            pic.style.top  = `${Math.random() * (window.innerHeight - 100)}px`;
            pic.addEventListener('click', () => { pic.remove(); startTimingMeter(); });
            document.body.appendChild(pic);
            setTimeout(() => { if (pic.parentElement) pic.remove(); }, 60000);
        }

        function scheduleRandomPicture() {
            setTimeout(() => { spawnRandomPicture(); scheduleRandomPicture(); },
                       Math.random() * 30000 + 30000);
        }
        scheduleRandomPicture();

        // ===== KARIM IMAGE =====
        function updateKarimImage() {
            const hasAirpods = shopItems.find(i => i.id === 'airpods').count > 0;
            const hasBeanie  = shopItems.find(i => i.id === 'beanie').count  > 0;
            const img = karimElement.querySelector('img');
            if (hasAirpods && hasBeanie) img.src = './resources/Karim-Beanie-Airpods.png';
            else if (hasAirpods)         img.src = './resources/Karim-Airpods.png';
            else if (hasBeanie)          img.src = './resources/Karim-Beanie.png';
            else                         img.src = './resources/karimfistbumper.png';
        }

        // ===== SHOP RENDER =====
        function renderShop() {
            shopItemsContainer.innerHTML = '';
            shopItems.forEach(item => {
                const cost = getItemCost(item);
                const canAfford = coins >= cost;
                const itemDiv = document.createElement('div');
                itemDiv.className = `shop-item ${!canAfford ? 'disabled' : ''}`;
                itemDiv.innerHTML = `
                    <div class="item-header">
                        <span class="item-name">${item.imageSrc
                            ? `<img src="${item.imageSrc}" style="width:50px;height:50px;vertical-align:middle;border-radius:4px;margin-right:5px;">`
                            : item.emoji} ${item.name}</span>
                        <span class="item-count">${item.count}</span>
                    </div>
                    <div class="item-description">${item.description}</div>
                    <div class="item-footer">
                        <span class="item-cost">üí∞ ${cost}</span>
                        <span class="item-effect">${item.effectType === 'cpc' ? `+${item.effect} per click` : `+${item.effect}/sec`}</span>
                    </div>`;
                if (canAfford) itemDiv.addEventListener('click', () => buyItem(item));
                shopItemsContainer.appendChild(itemDiv);
            });
        }

        // ===== DISPLAY =====
        function updateDisplay() {
            coinsDisplay.textContent          = Math.floor(coins);
            coinsPerClickDisplay.textContent  = coinsPerClick;
            coinsPerSecondDisplay.textContent = coinsPerSecond.toFixed(1);
        }

        // ===== PASSIVE INCOME =====
        setInterval(() => {
            if (coinsPerSecond > 0) { coins += (coinsPerSecond / 10) * globalMultiplier; updateDisplay(); }
        }, 100);

        renderShop();
        updateDisplay();

        // ===== SNAKE LOGIC =====
        const canvas  = document.getElementById('snakeGame');
        const context = canvas.getContext('2d');
        const grid    = 16;
        let count     = 0;

        const snake = { x: 160, y: 160, dx: grid, dy: 0, cells: [], maxCells: 4 };
        const apple = { x: 320, y: 320 };

        function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min)) + min; }

        function snakeLoop() {
            requestAnimationFrame(snakeLoop);
            if (!snakeRunning) return;
            if (++count < 4) return;
            count = 0;

            context.clearRect(0, 0, canvas.width, canvas.height);
            snake.x += snake.dx;
            snake.y += snake.dy;

            if (snake.x < 0)            snake.x = canvas.width  - grid;
            if (snake.x >= canvas.width) snake.x = 0;
            if (snake.y < 0)            snake.y = canvas.height - grid;
            if (snake.y >= canvas.height) snake.y = 0;

            snake.cells.unshift({ x: snake.x, y: snake.y });
            if (snake.cells.length > snake.maxCells) snake.cells.pop();

            context.fillStyle = 'red';
            context.fillRect(apple.x, apple.y, grid - 1, grid - 1);

            context.fillStyle = 'lime';
            snake.cells.forEach((cell, index) => {
                context.fillRect(cell.x, cell.y, grid - 1, grid - 1);

                if (cell.x === apple.x && cell.y === apple.y) {
                    snake.maxCells++;
                    coins += 25;
                    updateDisplay();
                    apple.x = getRandomInt(0, 25) * grid;
                    apple.y = getRandomInt(0, 25) * grid;
                }

                for (let i = index + 1; i < snake.cells.length; i++) {
                    if (cell.x === snake.cells[i].x && cell.y === snake.cells[i].y) {
                        snake.x = 160; snake.y = 160; snake.cells = [];
                        snake.maxCells = 4; snake.dx = grid; snake.dy = 0;
                    }
                }
            });
        }

        document.addEventListener('keydown', e => {
            if (!snakeRunning) return;
            if (e.key === 'ArrowLeft'  && snake.dx === 0) { snake.dx = -grid; snake.dy = 0; }
            else if (e.key === 'ArrowUp'    && snake.dy === 0) { snake.dy = -grid; snake.dx = 0; }
            else if (e.key === 'ArrowRight' && snake.dx === 0) { snake.dx =  grid; snake.dy = 0; }
            else if (e.key === 'ArrowDown'  && snake.dy === 0) { snake.dy =  grid; snake.dx = 0; }
        });

        requestAnimationFrame(snakeLoop);


        // ===================================================================
        // ===== MUSIC PLAYER ================================================
        // ===================================================================
        // Drop song1.mp3, song2.mp3, song3.mp3, and 4THSONG.mp3 into the
        // same folder as this HTML file. That's it ‚Äî no other changes needed.

        const tracks = [
            { file: 'song1.mp3',   label: 'Song 1' },
            { file: 'song2.mp3',   label: 'Song 2' },
            { file: 'song3.mp3',   label: 'Song 3' },
            { file: '4THSONG.mp3', label: 'Song 4' }   // ‚Üê rename file as needed
        ];

        const bgMusic      = document.getElementById('bgMusic');
        const nowPlaying   = document.getElementById('nowPlaying');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const trackBtns    = document.querySelectorAll('.track-btn');

        let currentTrackIndex = -1;   // -1 = nothing loaded yet
        let isPlaying         = false;

        // Load and play a track (0, 1, 2, or 3).
        // Clicking the active track toggles play/pause instead.
        function switchTrack(index) {
            if (index === currentTrackIndex) {
                togglePlayPause();
                return;
            }

            currentTrackIndex = index;
            bgMusic.src    = tracks[index].file;
            bgMusic.volume = parseFloat(volumeSlider.value);

            bgMusic.play()
                .then(() => {
                    isPlaying = true;
                    playPauseBtn.textContent = '‚è∏';
                    nowPlaying.textContent   = 'üéµ ' + tracks[index].label;
                })
                .catch(() => {
                    // Browser blocked autoplay before any user gesture ‚Äî
                    // the user can hit ‚ñ∂ to start manually.
                    isPlaying = false;
                    playPauseBtn.textContent = '‚ñ∂';
                    nowPlaying.textContent   = '‚ñ∂ Press play for ' + tracks[index].label;
                });

            // Highlight active button
            trackBtns.forEach((btn, i) => btn.classList.toggle('active', i === index));
        }

        // Toggle play / pause on whatever track is loaded
        function togglePlayPause() {
            if (currentTrackIndex === -1) { switchTrack(0); return; }

            if (isPlaying) {
                bgMusic.pause();
                isPlaying = false;
                playPauseBtn.textContent = '‚ñ∂';
                nowPlaying.textContent   = '‚è∏ ' + tracks[currentTrackIndex].label;
            } else {
                bgMusic.play();
                isPlaying = true;
                playPauseBtn.textContent = '‚è∏';
                nowPlaying.textContent   = 'üéµ ' + tracks[currentTrackIndex].label;
            }
        }

        // Volume control
        function setVolume(value) {
            bgMusic.volume = parseFloat(value);
        }

        // Safety net in case loop somehow ends
        bgMusic.addEventListener('ended', () => {
            isPlaying = false;
            playPauseBtn.textContent = '‚ñ∂';
        });
        // ===================================================================

    </script>
</body>
</html>
